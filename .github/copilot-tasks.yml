tasks:
  - name: setup-dev-hooks
    description: Install git pre-push hook to run cargo format, test, and lint checks
    command: |
      #!/bin/bash
      set -e
      
      # Create the pre-push hook
      HOOK_FILE=".git/hooks/pre-push"
      
      cat > "$HOOK_FILE" << 'EOF'
      #!/bin/bash
      
      # Pre-push hook for nutrition-fact-labeller-rust
      # This hook runs cargo fmt, cargo test, and cargo clippy before pushing
      
      set -e
      
      echo "Running pre-push checks..."
      
      # Check formatting
      echo "ðŸ” Checking code formatting with cargo fmt..."
      if ! cargo fmt --check; then
        echo "âŒ Code formatting check failed!"
        echo "   Run 'cargo fmt' to fix formatting issues."
        exit 1
      fi
      echo "âœ… Code formatting check passed"
      
      # Run tests
      echo "ðŸ§ª Running tests with cargo test..."
      if ! cargo test; then
        echo "âŒ Tests failed!"
        exit 1
      fi
      echo "âœ… Tests passed"
      
      # Run linter
      echo "ðŸ“‹ Running linter with cargo clippy..."
      if ! cargo clippy -- -D warnings; then
        echo "âŒ Linting failed!"
        echo "   Run 'cargo clippy' to see and fix linting issues."
        exit 1
      fi
      echo "âœ… Linting passed"
      
      echo "ðŸŽ‰ All pre-push checks passed!"
      EOF
      
      # Make the hook executable
      chmod +x "$HOOK_FILE"
      
      echo "âœ… Pre-push git hook installed successfully at $HOOK_FILE"
      echo ""
      echo "The hook will run the following checks before each push:"
      echo "  - cargo fmt --check (code formatting)"
      echo "  - cargo test (run tests)"
      echo "  - cargo clippy -- -D warnings (linting)"
      echo ""
      echo "To bypass the hook in emergency situations, use: git push --no-verify"
